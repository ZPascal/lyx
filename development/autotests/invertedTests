# Regular expressions for tests that are known to fail
#
# Patterns will be automatically enclosed with '^' and '$'.
# Matching tests get the label "inverted"
# or (if also matching a pattern in "suspendedTests") "suspended".
# They get also the test-property 'WILL_FAIL', i.e.
# they are reported as failing if the export works without error.
# https://cmake.org/cmake/help/v3.0/prop_test/WILL_FAIL.html

# ======================================================================
Sublabel: todo
# LyX bugs and problems with the sample documents that require attention
# ======================================================================
# * minor issues to explore and properly sort,
# * easyfix issues,
# * LyX bugs to report at trac (move pattern to section "lyxbugs" once done).

# Error in Japanese document if LyX-logo is preceded by foreign language
export/export/latex/ja_wrong_auto_encoding_(dvi|pdf(|3)).*

# missing character: There is no ^^A in font [lmroman12-regular]
# and all the line down to ^^Z and beyond...
# XeTeX artifact? works with LuaTeX, explore:
export/doc/(|de/|es/|fr/)EmbeddedObjects_pdf4_systemF

# iconv fails, if a nomenclature inset contains an uncodable character
export/export/latex/iconv-error-nomenclature_pdf2

# `acmart` document class:
# (see also lyxbugs below and ignoredTests)
# issues with listsof, reported to the maintainer
# https://www.mail-archive.com/search?l=mid&q=of84gj%24l6b%241%40blaine.gmane.org
# LyX gives the following terminal message:
#
#    TextClass.cpp (1385): The layout does not provide a list command for
#      the float `sidebar'. LyX will not be able to produce a float list.
#
# which makes "check_load" and "lyx2lyx" fail (lyx2lyx for < 2.3 is ignored).
check_load/templates/acmart
export/templates/acmart_lyx23

# Failing LyX2LyX conversions for old versions:
#
# "beamer" lyx2lyx fails sometimes for versions < 2.1
# Back-conversion results in some layouts without name ("\begin_layout \n")
# which trigger a warning message leading to test failure.
export/examples/(|de/|fr/|ja/)beamer_lyx(16|20)
export/templates/.*beamer-conference-ornate-20min_lyx(16|20)
export/examples/beamerlyxexample1_lyx(16|20)
#
# modernCV fails for versions < 2.1
# * reversed order of \end_layout and \end_inset results in corrupt LyX file
# * reversed order of command arguments results in incompilable LaTeX
export/examples/(|es/)modernCV_lyx(16|20)
#
# back-conversion fails for rotated float inset in a list
export/export/lyx2lyx/lyx_2_3_test_lyx(16|20|21|22)


# CJK
# Korean legacy encoding fails (missing fonts)
export/export/latex/CJK/ko_default_pdf2

# New problem with TL18: endless loop?
#    ! TeX capacity exceeded, sorry [input stack +size=5000].
export/export/latex/luainputenc-utf8_pdf5_texF


# nonstandard tests failing for unknown reason:
export/templates/obsolete/ACM-siggraph_pdf5_(texF|systemF)
export/templates/IUCr-article_pdf4_systemF
export/templates/RJournal_(dvi3|pdf[45])_systemF
export/templates/kluwer_.*_systemF


# ================================================
Sublabel: lyxbugs
# LyX bugs with a Trac number.
# ================================================

#6197: „amssymb” with Polish babel name clash \lll ("<<<" vs. "ł")
# Wrong output with pdflatex (-> unreliableTests),
# missing character with XeTeX/LuaTeX and Babel (OK with Polyglossia)
export/export/latex/6197-polish-amssymb_pdf._texF

#8035 work around a Polyglossia bug:
# An error is reported if the document font does not announce support for a
# script (Cyrillic, Greek, ...) which Polyglossia thinks is required to
# typeset the document language. This is not required with LyX's check for
# missing characters and results in many false positives:
# a) with fonts including the required characters but
#    not the tag tested by Polyglossia,
# b) if the document language is "Serbian (Latin Script)",
#    the Cyrillic script is not required yet Polyglossia tests for support.
# The document "sr/Braille.lyx" is an example of case b).
# (For some reason, the false positive error is not thrown with PDF (luatex).)
export/examples/sr/Braille_(dvi3|pdf4)_systemF

#9681 Run-together words in Greek and Cyrillic documents
# no-termination of replacement macros can lead to non-existing macros if
# unencodable or force-converted Greek or Cyrillic letters are immediately
# followed by Latin letters. See also unreliableTests.
export/export/latex/textcyr-textgreek-test_pdf2

#9871 LyX sends invalid Unicode to iconv when converting to ASCII
# most probably due to BabelPreamble code (language specific headings for
# theorems, problems , ... are written in the language's default encoding
# if they contain non-ASCII characters)
# Error 84 returned from iconv when converting from UCS-4LE to ascii:
# Invalid or incomplete multibyte or wide character
export/doc/(es|fr)/Additional_pdf4_texF
export/doc/(de|es|fr)/EmbeddedObjects_pdf4_texF
export/doc/es/Customization_pdf4_texF
# see also the discussion at:
# https://www.mail-archive.com/search?l=mid&q=20170228190738.cgs3tl3ny2bxiegk%40steph
export/examples/es/linguistics_pdf4_texF
export/export/latex/bug9871-slovak-ascii-preambleencoding_pdf2

#10355 xmllint detects failures
export/doc/attic/eu_UserGuide_xhtml
export/doc/(es|ja)/UserGuide_xhtml
export/examples/spreadsheet_xhtml
export/export/WrongDfnTagHandling_xhtml

#10371 Compilation error if longest label marker in labeling style
# contains underscores etc.
export/export/latex/LongestLabelWithUnderscore.*

#11455 "Unable to process argument!" with multiple 1.6.x roundtrips
export/templates/IEEEtran-Journal_lyx16

#10600 forced use of "ascii" inputenc with XeTeX
# Non-ASCII in ERT, fails with inputenc==ASCII
#   Could not find LaTeX command for character 'í' (code point 0xed)
export/doc/(de|es)/Additional_pdf4_texF
export/export/latex/xetex-inputenc-utf8_pdf4_texF

#11520 "listerrors" fails with pdflatex, lualatex, and xelatex
# Example for lib/scripts/listerrors
# Requires noweb. Seems to be restricted to plain "latex".
# Find out why and whether the script could be improved.
export/examples/listerrors_(pdf[245]).*

#11521 Font encoding "LAE" required with farsi.
# The Farsi font encoding LAE must be added also to a custom font encoding
# (similar to the Greek and Cyrillic font encodings LGR and T2A).
export/export/latex/fa-OT1_pdf2

#11522 Support specification of complementing non-TeX fonts
# More than one non-TeX font required for the character set in many documents
# to prevent "missing character" errors with non-TeX fonts
export/export/latex/luainputenc-utf8_pdf5_systemF
export/export/latex/xetex-inputenc.*_pdf4_systemF
#
export/doc/(|de/|es/|fr/)Math.*systemF
# minimal example for Math.lyx:
export/export/latex/systemfonts-Math-missingchars.*systemF
#
# CJK-quotes examples (missing in most Latin-script fonts)
export/doc/(|de/|es/|fr/)UserGuide_(dvi3|pdf4|pdf5)_systemF
#
#
# Arabic (see also "texissues")
# "! Extra \else" and missing glyph "no ␣ in font Scheherazade":
# (the lyx2lyx test also tests compilation after round-trip)
export/doc/ar/UserGuide_pdf4_systemF
export/doc/ar/UserGuide_lyx(22|23)
#
# Juergen Spitzmueller: They do not have problems with xunicode, but without.
# The reason is that the asterisk glyph is not included in the arabic font
# (Scheherazade), but apparently, xunicode defines an extra asterisk
# glyph (for a different purpose) that is being used here. Clearly the
# problem should be fixed somewhere else.
# Günter Milde: works in TeXLive17 (Debian/stretch)
# export/doc/ar/Intro_pdf4_systemF




# ==============================================================
Sublabel: ert
# Export failures due to "raw" LaTeX use in ERT or preamble code
# ==============================================================
#
# "Wontfix" if demonstrating correct use and OK in the default output format.


# ================================================
Sublabel: texissues
# Export fails due to LaTeX limitations,
# ================================================
#
# e.g. non-ASCII in verbatim or listings, incompatible packages, ...
# "Wontfix" if documents demonstrate correct use in the default output format.

# Non-ASCII char in verbatim environment.
# Fails with ASCII (and hence also with XeTeX).
export/doc/(|de/|es/|fr/)UserGuide_pdf4_texF

# Babel-Russian uses UTF-8 for auto-strings if it detects Xe/LuaTeX.
# This fails unless the inputencoding is set to utf-8, too.
export/doc/ru/(Intro|Tutorial)_(dvi3|pdf[45])_texF
export/examples/ru/(example_lyxified|Welcome)_(dvi3|pdf[45])_texF

# Babel-Ukrainian uses UTF-8 if it detects Xe/LuaTeX (for "\date").
# With 8-bit TeX fonts this results in:
# * garbled output with PDF (LuaTeX)
# * missing chars with XeTeX and DVI (LuaTeX)
# New in TL18 -> cf. unreliableTests.varying_versions.
# Workaround: suppressing auto-date or using date inset (new in LyX 2.4)
# 	      in the source documents.
export/export/latex/uk-babel-date-missing-chars-with-ascii_(pdf4|dvi3)_texF
export/(doc|examples)/uk/(Intro|Welcome)_(pdf4|dvi3)_texF

# Fails with XeTeX/LuaTeX
# Reported upstream (https://www.mail-archive.com/lyx-devel@lists.lyx.org/msg184435.html)
# Is there a new version fixing the problem?
export/examples/aa_sample_(dvi3|pdf[45])_.*
export/templates/aa_(dvi3|pdf[45])_.*

# Gives the following error:
# # ! Package hpstatement Error: H or P statement "H251"
# # (hpstatement)                is not defined.
# seems to be polyglossia-related (dvi3 worked with babel)
export/examples/H-P-statements_.*_systemF

# These files use packages that are not compatible with the newest LuaTeX. We
# could potentially fix these by loading the luatex85 package early in the
# LyX-generated preamble, but it seems it's better to wait until the packages
# fix the root issue themselves.
# xy package:
.*(|fr/)xy(pic|figure).*pdf5.*

# Problem with Check and Slovak Babel support.
# (reported per mail to Petr Tesa\v{r}\'ik, 2016-09-06)
# All exports using babel fail.
# Without the Czech or Slovak text it compiles
# No problem with inserted German (or other foreign language) text
# No problem if the table is Slovak, too
export/export/latex/TableErrorIfSlovakTextInserted_(dvi|pdf[23]?|.*_texF)

# Polyglossia + LuaTeX issue
# Reported upstream here:
# https://github.com/reutenauer/polyglossia/issues/163
# These tests were broken at 3374b854
# See discussion here:
# https://www.mail-archive.com/search?l=mid&q=1478004223.2367.5.camel%40lyx.org
export/doc/(sk|nb)/Intro_(dvi3|pdf5)_systemF

# fontspec errors with `slides` class:
# LaTeX error: "kernel/command-already-defined"
# Lines 2684 ... 2690 in fontspec-xetex.sty
# Lines 2608 ... 2614 in fontspec-luatex.sty
export/templates/slides_.*_systemF

# Beamer: conflicts with some combinations of packages/settings/languages
export/templates/ja_beamer-conference-ornate-20min_(pdf2|pdf[45]).*
export/templates/es_beamer-conference-ornate-20min_pdf4_texF

# Arabic
#
# Larger Arabic documents currently have non-TeX fonts and XeTeX
# as default output. To fix pdfTeX export:
# - set all non-Arab text parts to a different language (e.g. English)
# - define alternatives for hyperref (e.g. with textorpdfstring)
#   for correct handling of hyperref.
# - solve problem with ToC:
#      ! This can't happen (copying).
#      \AtBegShi@Output ...ipout \box \AtBeginShipoutBox
#                                                        \fi \fi
#      l.62 \tableofcontents
#                           {}
#      I'm broken. Please show this to someone who can fix can fix
#
# see discussion at https://www.mail-archive.com/search?l=mid&q=20161114035123.s5lt4ib4x4obtptp%40steph
#
# Babel-Arabic loads "inputenc" which fails with Xe/LuaTeX:
export/.*/ar/.*_texF
# Polyglossia bug with LuaTeX and LTR languages (also Hebrew and Farsi):
# Undefined control sequences "\luatexpardir" and "\luatextextdir".
export/.*/ar/.*(dvi3|pdf5)_systemF

# Farsi
# Polyglossia problem with LuaTeX (undefined command) (cf. Arabic)
# https://github.com/reutenauer/polyglossia/commit/ccb0e9e2c6411170ad779b05ff5076f1193cc323
export/examples/fa/Welcome_(dvi3|pdf5)_systemF
# Missing characters (em space and "English" quotes) with XeTeX + system fonts.
export/examples/fa/Welcome_pdf4_systemF
# missing ASCII replacements (required by XeTeX + TeX fonts)
export/examples/fa/Welcome_pdf4_texF
# "invalid utf-8 sequence" with Babel-Farsi, LuaTeX, and TeX fonts.
export/examples/fa/Welcome_(dvi3|pdf5)_texF

# Hebrew
# does not currently work with LuaTeX (undefined command) (cf. Arabic)
# terminal message: "Language hebrew not found in language.dat.lua"
export/.*/he/.*(dvi3|pdf5)_systemF
# Babel-Arabic loads "inputenc" which fails with Xe/LuaTeX
# additionally: "! Right-to-Left Support Error: use TeX--XeT or e-TeX engine."
# and (with XeTeX) missing ASCII replacements.
export/.*/he/.*_texF

# CJKutf8 does not work with XeTeX and LuaTeX (and 8-bit fonts)
export/examples/ja/multilingual_.*_texF
export/export/latex/CJK/zh_CN-toc_.*_texF

# See comment in unreliableTests
export/export/latex/uk-babel-date-missing-chars-with-ascii_pdf5_texF


# ================================================
Sublabel: externalissues
# Export fails due to non-LaTeX external tool,
# ================================================
#
# e.g. a bug or missing feature in ps2pdf

# ps2pdf gives the following and exits with error:
# Error: /invalidfileaccess in --file--
# ps2pdf succeeds if the -dNOSAFER flag is used. For discussion, see:
# https://www.mail-archive.com/search?l=mid&q=1506851183.3130.15.camel%40lyx.org
export/examples/ja/lilypond_pdf

# ps2pdf gives the following error on updated TL18:
#   Error: /undefined in d7Z
# For previous TL versions, there is no error but the output is incorrect
# (jibberish instead of Japanese characters).
export/doc/ja/UserGuide_pdf
# Simliar situation for this document, with the following error:
#   Error: /undefined in =52+WsoG&
export/doc/ja/Additional_pdf



# ======================================================================
Sublabel: attic
# Documents in the attic, kept for reference and format conversion test.
# However, many problems here are "wontfix".
# ======================================================================

# Fails because of missing .png graphic files.
# They were replaced by .svgz, but, as this file is in the attic, we do not
# convert to new lyx format. Plain latex and xetex create output (ignoring
# missing files) while (pdf|lua)latex exits with != 0
#export/doc/attic/eu_UserGuide_pdf[25].*

# Files in the attic with non-default output
# (i.e. could be ERT, package incompatiblity, ...)
export/doc/attic/it_(UserGuide_dvi3|UserGuide_pdf4)_systemF
export/doc/attic/sk_UserGuide_pdf4_texF
export/doc/attic/id_UserGuide_.*systemF
